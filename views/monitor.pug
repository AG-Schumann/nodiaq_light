extends layout

block extrahead
  link(rel="stylesheet" href="/stylesheets/overview.css")
  link(rel="stylesheet" href="/stylesheets/monitor.css")

  script(src="javascripts/bootstrap-toggle.min.js", type="text/javascript")
  link(rel="stylesheet", href="stylesheets/bootstrap-toggle.css")

  script(src="javascripts/monitor_scripts.js", type='text/javascript')

block content
  div.main-container(style='background-color:#eeeeee;margin:-5px;padding:15px;height:100vh')
    div
      div(style="width: 800px;resize: horizontal; overflow: hidden;")
        object(type="image/svg+xml" id="svg_frame1" data="images/monitor_tpc_layout.svg" style="width:100%;" class="tpcview" )

      div.noprint
        div.row(style="width:100%;margin:0;padding-top:5px;background-color:#f0f0f0;")
          table
            tr
              td(colspan="3", style="font-weight:bold;text-align:left") View

            tr(title="Select the way the PMTs are sorted and grouped here.")
              td PMT Layout:
              td(colspan = 3)
                select#layout_switcher(name='view_style', onchange="switch_layout(this.value)")
                  option(value='tpc') TPC
                  option(value='he') High Energy Array
                  option(value='vme') VME-crates
                  option(value='opt') Optical Links
                  option(value='amp') Amplifiers
                  option(value='init') Numerical
                  option(value='3d') 3D
                  option(value='off') OFF

            tr(title="Check for live data?")
              td Live data:
              td
                input#monitor_live_toggle(type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="warning" data-on="live" data-off="off" data-size='small' checked)
            tr(title="Automatically scale the colors")
              td Datarate scale:
              td
                input#legend_auto_set(type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="warning" data-on="auto" data-off="fixed" data-size='small' checked)
            tr(title="Which pmts should be ignored when checking for the max rate (comma seperated, no spaces)")
              td Ignore PMTs:
              td(colspan = 3)
                input(id="field_ignore_pmts", size="25", value = "453", onchange='update_pmts_to_ignore_for_rate()')
            tr(title="Linear or logarithmic color scale")
              td Colour scale:
              td
                input#legend_color_scale_log(onchange='update_color_scheme()', type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="warning" data-on="log" data-off="lin" data-size='small' checked)
            tr(title="Face out any PMTs with a datarate below the lower limit")
              td Fading:
              td
                input#monitor_fade_toggle(type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="warning" data-on="fading" data-off="off" data-size='small' checked)
            tr(title="Display the PMT labels")
              td PMT Labels:
              td
                input#monitior_pmt_text_view_switch(onchange='switch_pmt_channel_text_visibility(this.value)', type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="warning" data-on="visible" data-off="hidden" data-size='small' checked)
            tr
              td Time shown
              td
                input(id="field_current_timestamp", value="-1", size="25", title="this time is currently displayed")
              td
                button.btn.btn-default(onclick="force_show_timestamp()", onchange="force_show_timestamp()" title="Press this button to show the time in this field (for manual adjustment: turn of 'Live data' first).") show

            tr
              td
                input#monitior_playback(onchange='playback_wrapper()', type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="warning" data-on="start playback" data-off="playback" data-size='small' checked, title="if the currently displayed time is in the past you can playback what happend up to the present at twice the speed. Pause the playback at any point by clicking the button again. If you reach the present the normal live view will resume.")
                td(colspan="3", title="jump back/forward in time.")
                  button.btn.btn-default(onclick="jump_in_time(-10)") -10
                  span(width="10") &nbsp;
                  button.btn.btn-default(onclick="jump_in_time(-1)") -1
                  span(width="10") &nbsp;
                  button.btn.btn-default(onclick='jump_in_time(1)') +1
                  span(width="10") &nbsp;
                  button.btn.btn-default(onclick='jump_in_time(10)') +10
                  span(width="10") &nbsp;
                  a(href="https://xe1t-wiki.lngs.infn.it/doku.php?id=xenon:xenonnt:dsg:daq:daq-monitor")
                    button.btn.btn-default() Help (wiki)

        br
        br
        br
        // controls for history
        div.row(style="width:100%;margin:0;padding-top:5px;background-color:#f0f0f0;")
          table
            tr(title="The start of the trendview. Set to the time when the page was loaded.")
              td
                span(style="font-weight:bold;text-align:left") Trend view

            tr(title="The end of the trendview. Set to the time when the page was loaded, must be changed manually")
              td Time start
                td
                  input(id="field_history_start", value="-1", size="25", title="Start of Trendview")
                td
                  button.btn.btn-default(onclick="force_show_timestamp('field_history_start')", title="show this  time in tpc view") show &nbsp;
                  span(width="10") &nbsp;
                  button.btn.btn-default(onclick="usetimestamp('field_history_start')", title="fill this field with currently tpc view timestamp") use displayed time

            tr
              td Time end
              td
                input(id="field_history_end", value="-1", size="25", title="End of Trendview")
              td
                button.btn.btn-default(onclick="force_show_timestamp('field_history_end')", title="show this  time in tpc view") show &nbsp;
                span(width="10") &nbsp;
                button.btn.btn-default(onclick="usetimestamp('field_history_end')", title="fill this field with currently tpc view timestamp") use displayed time

            tr(title="which pmts shall be plotted below (comma seperated, no spaces). Click pmts in tpc view to fill.")
              td Pmts for line plot
              td
                input(id="field_line_plot_pmts", size="25")

            tr(title="determines behaviour when hovering over points in Trendview (scatter: show closest point in r-direction, line: in t-direction, but human readable date).")
              td Plot style
              td
                input#monitor_trend_style(type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="warning" data-on="Scatter" data-off="Line" data-size='small' checked)

            tr(title="Remove values of begining of series if more than this number of datapoints exist. Needs to be swiched on by the toggle on the right.")
              td Keep latest values
              td
                input(id="trendview_last_values_N", size="5", value="300")
                span(width="10") &nbsp;
                input#monitor_trend_max_five_minues(type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="warning" data-on="show all" data-off="remove old" data-size='small' checked, title="this is the toggle that determines whether data is cut of or not.")

            tr(title="Auto-Update of Trendview: Whether or not newly obtained datapoints shall be appended to trendview.")
              td Append live data
              td
                input#monitor_trend_follow(type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="warning" data-on="no appending" data-off="appending live data" data-size='small' checked)

            tr
              td(colspan="4")
                button.btn.btn-default(onclick="trendview_get_data_full()", title="Draws trendline for given point in time with selected setting.") draw trendlines
                span(width="10") &nbsp;
                button.btn.btn-default(onclick="start_follow_N_values()", title="Sets time values such that the last N values will be loaded, enables auto update and auto cutoff.") follow last N values

            tr
              td &nbsp;
              td(colspan="3")
                div#monitor_trend_status(style="color: red")

        div(style="height:720px;width:800px;resize: horizontal; overflow: hidden; border: 1px solid black")
          figure(class="highcharts-figure" style="width:100%; height:100%; overflow: hidden;")
            div#highcharts-figure(style="width:100%; height:100%; overflow: hidden;")

  script.
    $(document).ready(function(){
        initialize_pmts();
    });

